<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudScore - Qu·∫£n l√Ω ƒëi·ªÉm h·ªçc sinh</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <!-- SheetJS for Excel import -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>CloudScore - H·ªá th·ªëng qu·∫£n l√Ω ƒëi·ªÉm</h1>
            <div class="header-actions">
                <button id="importExcelBtn" class="btn-secondary">üìä Import Excel</button>
                <button id="addRecordBtn" class="btn-primary">+ Th√™m b·∫£n ghi m·ªõi</button>
            </div>
        </header>

        <div id="searchBar">
            <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm theo t√™n, l·ªõp...">
            <button id="refreshBtn" class="btn-secondary">üîÑ L√†m m·ªõi</button>
        </div>

        <div id="cardsContainer" class="cards-grid">
            <!-- Cards s·∫Ω ƒë∆∞·ª£c t·∫°o ƒë·ªông b·∫±ng JavaScript -->
            <div class="initial-loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">ƒêang t·∫£i d·ªØ li·ªáu...</div>
                <div class="loading-subtext">Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t</div>
            </div>
        </div>
    </div>

    <!-- Modal chi ti·∫øt nh√≥m -->
    <div id="detailModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="modalTitle">
                    <span class="modal-icon">üìã</span>
                    Chi ti·∫øt b·∫£n ghi
                </h2>
                <span class="close">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="detail-section">
                    <div class="info-group">
                        <label>
                            <span class="label-icon">üìù</span>
                            T√™n b·∫£n ghi:
                        </label>
                        <input type="text" id="recordName" placeholder="VD: 6A8 - B·∫£n ghi 10/10/2025">
                    </div>
                    
                    <div class="info-group">
                        <label>
                            <span class="label-icon">üè´</span>
                            L·ªõp:
                        </label>
                        <input type="text" id="recordClass" placeholder="Nh·∫≠p l·ªõp (VD: 6A8)">
                    </div>
                </div>

                <div class="scores-section">
                    <!-- Statistics Section -->
                    <div id="statisticsSection" class="statistics-section">
                        <div class="stats-header">
                            <h3>
                                <span class="stats-icon">üìä</span>
                                Th·ªëng k√™ ƒëi·ªÉm s·ªë
                            </h3>
                            <button id="toggleStatsBtn" class="btn-icon-only" title="Thu g·ªçn/M·ªü r·ªông">
                                <span id="toggleStatsIcon">‚ñº</span>
                            </button>
                        </div>
                        <div id="statsContent" class="stats-content">
                            <div class="stats-grid">
                                <div class="stat-card stat-excellent">
                                    <div class="stat-icon">üèÜ</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Gi·ªèi (8.0-10)</div>
                                        <div class="stat-value" id="statExcellent">0</div>
                                        <div class="stat-percent" id="statExcellentPercent">0%</div>
                                    </div>
                                </div>
                                <div class="stat-card stat-good">
                                    <div class="stat-icon">‚≠ê</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Kh√° (6.5-8.0)</div>
                                        <div class="stat-value" id="statGood">0</div>
                                        <div class="stat-percent" id="statGoodPercent">0%</div>
                                    </div>
                                </div>
                                <div class="stat-card stat-average">
                                    <div class="stat-icon">üìò</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Trung b√¨nh (5.0-6.5)</div>
                                        <div class="stat-value" id="statAverage">0</div>
                                        <div class="stat-percent" id="statAveragePercent">0%</div>
                                    </div>
                                </div>
                                <div class="stat-card stat-weak">
                                    <div class="stat-icon">üìï</div>
                                    <div class="stat-info">
                                        <div class="stat-label">Y·∫øu (<5.0)</div>
                                        <div class="stat-value" id="statWeak">0</div>
                                        <div class="stat-percent" id="statWeakPercent">0%</div>
                                    </div>
                                </div>
                            </div>
                            <div class="stats-summary">
                                <div class="summary-row">
                                    <span class="summary-icon">üìà</span>
                                    <span class="summary-label">ƒêi·ªÉm TB l·ªõp:</span>
                                    <span class="summary-value highlight" id="classAverage">-</span>
                                </div>
                                <div class="summary-row">
                                    <span class="summary-icon">üîù</span>
                                    <span class="summary-label">ƒêi·ªÉm cao nh·∫•t:</span>
                                    <span class="summary-value success" id="highestScore">-</span>
                                </div>
                                <div class="summary-row">
                                    <span class="summary-icon">üìâ</span>
                                    <span class="summary-label">ƒêi·ªÉm th·∫•p nh·∫•t:</span>
                                    <span class="summary-value danger" id="lowestScore">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section-header">
                        <h3>
                            <span class="section-icon">üë•</span>
                            Danh s√°ch h·ªçc sinh
                        </h3>
                        <div class="section-actions">
                            <button id="addColumnBtn" class="btn-small btn-icon-text">
                                <span>‚ûï</span> Th√™m c·ªôt ƒëi·ªÉm
                            </button>
                            <button id="addStudentBtn" class="btn-small btn-icon-text">
                                <span>üë§</span> Th√™m h·ªçc sinh
                            </button>
                            <button id="batchImportBtn" class="btn-small btn-icon-text">
                                <span>üì•</span> Import h√†ng lo·∫°t
                            </button>
                        </div>
                    </div>
                    
                    <!-- Search and Filter Controls -->
                    <div class="table-controls">
                        <div class="search-control">
                            <span class="control-icon">üîç</span>
                            <input type="text" id="studentSearchInput" placeholder="T√¨m ki·∫øm theo t√™n h·ªçc sinh...">
                        </div>
                        <div class="filter-controls">
                            <div class="filter-item">
                                <label>
                                    <span class="control-icon">üìã</span>
                                    Hi·ªÉn th·ªã c·ªôt:
                                </label>
                                <button id="columnVisibilityBtn" class="btn-filter">
                                    <span>‚öôÔ∏è</span> Ch·ªçn c·ªôt
                                </button>
                            </div>
                            <div class="filter-item">
                                <label>
                                    <span class="control-icon">üéØ</span>
                                    L·ªçc theo:
                                </label>
                                <select id="filterByScore" class="filter-select">
                                    <option value="all">T·∫•t c·∫£ h·ªçc sinh</option>
                                    <option value="has-value">C√≥ ƒëi·ªÉm</option>
                                    <option value="no-value">Ch∆∞a c√≥ ƒëi·ªÉm</option>
                                </select>
                                <select id="filterColumn" class="filter-select" style="display:none;">
                                    <option value="">-- Ch·ªçn c·ªôt --</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div id="studentsTable">
                        <!-- B·∫£ng h·ªçc sinh s·∫Ω ƒë∆∞·ª£c t·∫°o ·ªü ƒë√¢y -->
                    </div>
                </div>

                <div class="metadata-section">
                    <div class="metadata-item">
                        <span class="metadata-icon">üïê</span>
                        <strong>Ng√†y t·∫°o/s·ª≠a:</strong>
                        <span id="lastModified">-</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-icon">üìä</span>
                        <strong>S·ªë h·ªçc sinh:</strong>
                        <span id="studentCount">0</span>
                    </div>
                    <div class="metadata-item" id="autoSaveStatus">
                        <span class="metadata-icon">üíæ</span>
                        <strong>Tr·∫°ng th√°i:</strong>
                        <span id="saveStatus" class="save-status saved">ƒê√£ l∆∞u</span>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button id="saveBtn" class="btn-primary">
                    <span class="btn-icon-prefix">üíæ</span>
                    L∆∞u b·∫£n ghi
                </button>
                <button id="exportExcelBtn" class="btn-secondary" style="background: linear-gradient(135deg, #10b981, #059669);">
                    <span class="btn-icon-prefix">üìä</span>
                    Export Excel
                </button>
                <button id="exportPdfBtn" class="btn-secondary" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                    <span class="btn-icon-prefix">üìÑ</span>
                    Export PDF
                </button>
                <button id="deleteBtn" class="btn-danger">
                    <span class="btn-icon-prefix">üóëÔ∏è</span>
                    X√≥a b·∫£n ghi
                </button>
                <button id="cancelBtn" class="btn-secondary">
                    <span class="btn-icon-prefix">‚úñÔ∏è</span>
                    ƒê√≥ng
                </button>
            </div>
        </div>
    </div>

    <!-- Modal th√™m/s·ª≠a h·ªçc sinh -->
    <div id="studentModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3 id="studentModalTitle">
                    <span class="modal-icon">üë§</span>
                    Th√™m h·ªçc sinh
                </h3>
                <span class="close">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="info-group">
                    <label>
                        <span class="label-icon">‚úèÔ∏è</span>
                        H·ªç v√† t√™n:
                    </label>
                    <input type="text" id="studentName" placeholder="Nh·∫≠p t√™n h·ªçc sinh">
                </div>
                <div id="studentScores">
                    <!-- C√°c √¥ ƒëi·ªÉm s·∫Ω ƒë∆∞·ª£c t·∫°o ƒë·ªông -->
                </div>
            </div>
            
            <div class="modal-footer">
                <button id="saveStudentBtn" class="btn-primary">
                    <span class="btn-icon-prefix">üíæ</span>
                    L∆∞u
                </button>
                <button id="cancelStudentBtn" class="btn-secondary">
                    <span class="btn-icon-prefix">‚úñÔ∏è</span>
                    H·ªßy
                </button>
            </div>
        </div>
    </div>

    <!-- Modal import batch -->
    <div id="batchModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <span class="modal-icon">üì•</span>
                    Import danh s√°ch h·ªçc sinh
                </h3>
                <span class="close">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="info-notice">
                    <span class="notice-icon">‚ÑπÔ∏è</span>
                    <div>
                        <p><strong>Format:</strong> <code>T√™n, ƒêi·ªÉm1, ƒêi·ªÉm2, ...</code></p>
                        <p><small>M·ªói h·ªçc sinh m·ªôt d√≤ng. VD: <code>Nguy·ªÖn VƒÉn A, 8.5, 9.0</code></small></p>
                    </div>
                </div>
                
                <div class="info-group">
                    <label>
                        <span class="label-icon">üìÑ</span>
                        D·ªØ li·ªáu:
                    </label>
                    <textarea id="batchData" rows="10" placeholder="Nguy·ªÖn VƒÉn A, 8.5, 9.0&#10;Tr·∫ßn Th·ªã B, 7.5, 8.0&#10;L√™ VƒÉn C, 9.0, 9.5"></textarea>
                </div>
            </div>
            
            <div class="modal-footer">
                <button id="processBatchBtn" class="btn-primary">
                    <span class="btn-icon-prefix">üì•</span>
                    Import
                </button>
                <button id="cancelBatchBtn" class="btn-secondary">
                    <span class="btn-icon-prefix">‚úñÔ∏è</span>
                    H·ªßy
                </button>
            </div>
        </div>
    </div>

    <!-- Modal th√™m/s·ª≠a c·ªôt ƒëi·ªÉm -->
    <div id="columnModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3 id="columnModalTitle">
                    <span class="modal-icon" id="columnModalIcon">‚ûï</span>
                    <span id="columnModalTitleText">Th√™m c·ªôt ƒëi·ªÉm m·ªõi</span>
                </h3>
                <span class="close">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="info-notice">
                    <span class="notice-icon">üí°</span>
                    <div>
                        <p id="columnModalHint">Nh·∫≠p t√™n c·ªôt ƒëi·ªÉm. V√≠ d·ª•: ƒêi·ªÉm gi·ªØa k·ª≥, ƒêi·ªÉm cu·ªëi k·ª≥, ƒêi·ªÉm th·ª±c h√†nh...</p>
                    </div>
                </div>

                <div class="info-group">
                    <label>
                        <span class="label-icon">üìä</span>
                        T√™n c·ªôt:
                    </label>
                    <input type="text" id="columnNameInput" placeholder="VD: ƒêi·ªÉm gi·ªØa k·ª≥, ƒêi·ªÉm cu·ªëi k·ª≥..." autocomplete="off">
                    <div id="columnNameError" class="input-error" style="display: none;">
                        <span class="error-icon">‚ö†Ô∏è</span>
                        <span class="error-text"></span>
                    </div>
                </div>

                <div id="oldColumnInfo" class="old-column-info" style="display: none;">
                    <div class="info-row">
                        <span class="info-label">T√™n c·ªôt hi·ªán t·∫°i:</span>
                        <span class="info-value" id="oldColumnName">-</span>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button id="confirmColumnAction" class="btn-primary">
                    <span class="btn-icon-prefix" id="confirmColumnIcon">‚úîÔ∏è</span>
                    <span id="confirmColumnText">Th√™m</span>
                </button>
                <button id="cancelColumnAction" class="btn-secondary">
                    <span class="btn-icon-prefix">‚úñÔ∏è</span>
                    H·ªßy
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Import Excel -->
    <div id="excelModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>
                    <span class="modal-icon">üìä</span>
                    Import d·ªØ li·ªáu t·ª´ Excel
                </h3>
                <span class="close">&times;</span>
            </div>
            
            <div class="modal-body">
                <!-- File Upload Section -->
                <div class="excel-upload-section">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">üìÅ</div>
                        <h4>Ch·ªçn ho·∫∑c k√©o th·∫£ file Excel v√†o ƒë√¢y</h4>
                        <p>H·ªó tr·ª£: .xlsx, .xls, .csv</p>
                        <input type="file" id="excelFileInput" accept=".xlsx,.xls,.csv" style="display: none;">
                        <button class="btn-primary" onclick="document.getElementById('excelFileInput').click()">
                            Ch·ªçn File
                        </button>
                    </div>
                </div>

                <!-- File Info -->
                <div id="fileInfo" class="file-info" style="display: none;">
                    <div class="info-card">
                        <span class="info-icon">üìÑ</span>
                        <div>
                            <strong id="fileName">-</strong>
                            <p id="fileSize">-</p>
                        </div>
                    </div>
                </div>

                <!-- Preview Section -->
                <div id="previewSection" style="display: none;">
                    <div class="section-header">
                        <h4>
                            <span class="section-icon">üëÅÔ∏è</span>
                            Xem tr∆∞·ªõc d·ªØ li·ªáu
                        </h4>
                        <div class="preview-controls">
                            <label>
                                Sheet:
                                <select id="sheetSelector" class="sheet-select"></select>
                            </label>
                        </div>
                    </div>
                    
                    <div id="previewTable" class="preview-table-wrapper"></div>
                </div>

                <!-- Mapping Section -->
                <div id="mappingSection" style="display: none;">
                    <div class="section-header">
                        <h4>
                            <span class="section-icon">üîó</span>
                            √Ånh x·∫° c·ªôt (t·ª± ƒë·ªông ph√°t hi·ªán)
                        </h4>
                    </div>
                    
                    <div class="mapping-grid">
                        <div class="mapping-item">
                            <label>
                                <span class="label-icon">üë§</span>
                                C·ªôt t√™n h·ªçc sinh:
                            </label>
                            <select id="nameColumnMap" class="mapping-select"></select>
                        </div>
                        
                        <div class="mapping-item">
                            <label>
                                <span class="label-icon">üè´</span>
                                C·ªôt l·ªõp (optional):
                            </label>
                            <select id="classColumnMap" class="mapping-select">
                                <option value="">-- Kh√¥ng c√≥ --</option>
                            </select>
                        </div>
                        
                        <div class="mapping-item full-width">
                            <label>
                                <span class="label-icon">üìä</span>
                                C√°c c·ªôt ƒëi·ªÉm s·ªë:
                            </label>
                            <div id="scoreColumnsMap" class="score-columns-map"></div>
                        </div>
                    </div>

                    <div class="info-notice">
                        <span class="notice-icon">üí°</span>
                        <div>
                            <strong>G·ª£i √Ω:</strong>
                            <p>H·ªá th·ªëng ƒë√£ t·ª± ƒë·ªông ph√°t hi·ªán c√°c c·ªôt. B·∫°n c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh n·∫øu c·∫ßn.</p>
                        </div>
                    </div>
                </div>

                <!-- Summary Section -->
                <div id="summarySection" style="display: none;">
                    <div class="summary-card">
                        <h4>üìã T·ªïng quan d·ªØ li·ªáu</h4>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <span class="summary-icon">üë•</span>
                                <div>
                                    <strong id="totalStudents">0</strong>
                                    <p>H·ªçc sinh</p>
                                </div>
                            </div>
                            <div class="summary-item">
                                <span class="summary-icon">üìä</span>
                                <div>
                                    <strong id="totalScores">0</strong>
                                    <p>C·ªôt ƒëi·ªÉm</p>
                                </div>
                            </div>
                            <div class="summary-item">
                                <span class="summary-icon">üè´</span>
                                <div>
                                    <strong id="detectedClass">-</strong>
                                    <p>L·ªõp</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button id="importExcelDataBtn" class="btn-primary" style="display: none;">
                    <span class="btn-icon-prefix">üì•</span>
                    Import D·ªØ Li·ªáu
                </button>
                <button id="cancelExcelBtn" class="btn-secondary">
                    <span class="btn-icon-prefix">‚úñÔ∏è</span>
                    ƒê√≥ng
                </button>
            </div>
        </div>
    </div>

    <!-- Popup th√¥ng b√°o l·ªói -->
    <div id="errorPopup" class="popup-modal">
        <div class="popup-content">
            <span id="errorPopupIcon">‚ùå</span>
            <span id="errorPopupMsg"></span>
            <button id="errorPopupClose" class="btn-danger">ƒê√≥ng</button>
        </div>
    </div>

    <!-- Popup loading -->
    <div id="loadingPopup" class="popup-modal">
        <div class="popup-content">
            <span id="loadingPopupIcon">‚è≥</span>
            <span id="loadingPopupMsg">ƒêang x·ª≠ l√Ω...</span>
        </div>
    </div>

    <!-- Popup confirm -->
    <div id="confirmPopup" class="popup-modal">
        <div class="popup-content">
            <span id="confirmPopupIcon">‚ùì</span>
            <span id="confirmPopupMsg"></span>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button id="confirmPopupYes" class="btn-primary">ƒê·ªìng √Ω</button>
                <button id="confirmPopupNo" class="btn-secondary">H·ªßy</button>
            </div>
        </div>
    </div>

    <!-- Modal ch·ªçn c·ªôt hi·ªÉn th·ªã -->
    <div id="columnVisibilityModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>
                    <span class="modal-icon">üëÅÔ∏è</span>
                    Ch·ªçn c·ªôt hi·ªÉn th·ªã
                </h3>
                <span class="close">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="info-notice">
                    <span class="notice-icon">üí°</span>
                    <div>
                        <p><strong>G·ª£i √Ω:</strong> Ch·ªçn c√°c c·ªôt ƒëi·ªÉm b·∫°n mu·ªën hi·ªÉn th·ªã trong b·∫£ng. N·∫øu kh√¥ng ch·ªçn c·ªôt n√†o, t·∫•t c·∫£ c√°c c·ªôt s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã.</p>
                    </div>
                </div>

                <div class="column-visibility-options">
                    <div class="quick-actions">
                        <button id="selectAllColumns" class="btn-small btn-secondary">
                            <span>‚úì</span> Ch·ªçn t·∫•t c·∫£
                        </button>
                        <button id="deselectAllColumns" class="btn-small btn-secondary">
                            <span>‚úó</span> B·ªè ch·ªçn t·∫•t c·∫£
                        </button>
                    </div>
                    
                    <div id="columnCheckboxList" class="column-checkbox-list">
                        <!-- Checkboxes will be generated here -->
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button id="applyColumnVisibility" class="btn-primary">
                    <span class="btn-icon-prefix">‚úîÔ∏è</span>
                    √Åp d·ª•ng
                </button>
                <button id="cancelColumnVisibility" class="btn-secondary">
                    <span class="btn-icon-prefix">‚úñÔ∏è</span>
                    H·ªßy
                </button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
